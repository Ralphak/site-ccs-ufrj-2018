var resumo,epi,executor,encarregado,consideracoes,obs,descricao,body=document.getElementsByTagName("body")[0],btnEstatisticas=document.getElementById("btn-estatisticas"),completas=[],osEditada={},categoriasFuncionais=["técnico","estudante","docente"],oficinas=["Marcenaria","Hidráulica","Elétrica","Refrigeração","Pintura","Obras","Serralheria"],arrayUnidades=["Centro Nacional de Biologia Estrutural e Bioimagem (CENABIO)","Escola de Educação Física e Desportos (EEFD)","Escola de Enfermagem Anna Nery (EEAN)","Faculdade de Farmácia (FF)","Faculdade de Medicina (FM)","Faculdade de Odontologia (FO)","Hospital Universitário Clementino Fraga Filho (HUCFF)","Instituto de Atenção Primária de Saúde São Francisco de Assis (HESFA)","Instituto de Biofísica Carlos Chagas Filho (IBCCF)","Instituto de Biologia (IB)","Instituto de Bioquímica Médica (IBqM)","Instituto de Ciências Biomédicas (ICB)","Instituto de Doenças do Tórax - (IDT)","Instituto de Estudos de Saúde Coletiva (IESC)","Instituto de Ginecologia (IG)","Instituto de Microbiologia Professor Paulo de Góes (IMPPG)","Instituto de Neurologia Deolindo Couto (INDC)","Instituto de Nutrição Josué de Castro (INJC)","Instituto de Pesquisa de Produtos Naturais (IPPN)","Instituto de Psiquiatria (IPUB)","Instituto de Puericultura e Pediatria Martagão Gesteira (IPPMG)","Instituto do Coração Edson Abdala Saad (ICES)","Maternidade Escola (ME)","Núcleo de Pesquisas Ecológicas de Macaé (NUPEM)","Núcleo de Tecnologia Educacional para a Saúde (NUTES)","Decania do CCS"];unidadesAtendidas=["Centro Nacional de Biologia Estrutural e Bioimagem (CENABIO)","Escola de Educação Física e Desportos (EEFD)","Faculdade de Farmácia (FF)","Faculdade de Medicina (FM)","Instituto de Biofísica Carlos Chagas Filho (IBCCF)","Instituto de Biologia (IB)","Instituto de Bioquímica Médica (IBqM)","Instituto de Ciências Biomédicas (ICB)","Instituto de Microbiologia Professor Paulo de Góes (IMPPG)","Instituto de Nutrição Josué de Castro (INJC)","Instituto de Pesquisa de Produtos Naturais (IPPN)","Decania do CCS"];var recuperarDS=async function(tipo,id,ano,apenasConcluidas){var demandas,estadoResumo;return subtipos=tipo.split("_"),id||(id=""),ano||(ano=(new Date).getFullYear()),estadoResumo=apenasConcluidas?{estado:{$nin:["aberta","em andamento"]}}:{estado:["aberta","em andamento"]},await $.ajax({type:"GET",url:"/recuperarDs",data:{tipo,id,ano,estadoResumo},dataType:"json"}).done(function(msg){msg&&(demandas=msg)}).fail(function(msg){console.log("Fail! "+msg.data)}),demandas},atualizarDS=async(dsId,acao)=>{for(let i=0;i<completas.length;i++)completas[i]._id===dsId&&completas.splice(i,1);if("atualizar"===acao){let dsEditada=await recuperarDS("completa",dsId);completas.push(dsEditada)}},deletarDS=async function(id,acao){await $.ajax({type:"POST",url:"/manutencao/deletarDS",data:{id,acao},dataType:"json"}).done(function(msg){msg&&variaveisGlobais.exibirMensagem(msg,2e3,null)}).fail(function(msg){console.log("Fail! "+msg.data)})},editarOS=async function(obj){await $.ajax({type:"POST",url:"/manutencao/editarOS",data:obj,dataType:"json"}).done(function(msg){msg&&atualizarDS(msg.message,"atualizar")}).fail(function(msg){console.log("Fail! "+msg.data)})},deletarOS=async function(idOS,idDS){await $.ajax({type:"POST",url:"/manutencao/deletarOS",data:{idOrdem:idOS,idDemanda:idDS},dataType:"json"}).done(function(msg){msg&&(atualizarDS(msg.message,"deletar"),variaveisGlobais.exibirMensagem("<h2>Ordem de serviço excluída</h2>",2e3,null))}).fail(function(msg){console.log("Fail! "+msg.data)})},logAdm=async function(obj){await $.ajax({type:"POST",url:"/logAdm",data:obj,dataType:"json"}).done(function(msg){msg&&(variaveisGlobais.exibirMensagem(`<p>Sua mensagem:</p><p>"${obj.mensagem}"</p><p>foi inserida no histórico da DS</p>`,4e3,"Histórico da DS"),setTimeout(()=>{variaveisGlobais.controlarVisibilidade("ocultar","#overlay",500)},4e3))}).fail(function(msg){console.log("Fail! "+msg.data)})};let autoComplete=(inputSelector,divItems,item,itemsArray)=>{document.querySelector(divItems).addEventListener("click",evt=>{document.querySelector(inputSelector).value=evt.target.innerHTML}),document.querySelector(inputSelector).addEventListener("blur",e=>{let inputIsValid=!1,atendida=!1;for(let i=0;i<itemsArray.length;i++)if(itemsArray[i]===e.target.value){inputIsValid=!0,document.querySelector(`${divItems}`).innerHTML="";break}setTimeout(()=>{for(let i=0;i<unidadesAtendidas.length;i++)if(unidadesAtendidas[i]===e.target.value){atendida=!0;break}atendida||""===e.target.value||variaveisGlobais.exibirMensagem("<p>Reiteramos que atendemos apenas demandas originadas no âmbito do Prédio do CCS.</p>",3e3)},150),inputIsValid||(e.target.value="",setTimeout(()=>{document.querySelector(`${divItems}`).innerHTML=""},200))});document.querySelector(inputSelector).addEventListener("input",e=>{document.querySelector(inputSelector).value.length>=2?(()=>{document.querySelector(divItems).innerHTML="";for(let i=0;i<itemsArray.length;i++)itemsArray[i].toUpperCase().includes(document.querySelector(inputSelector).value.toUpperCase())&&document.querySelector(divItems).insertAdjacentHTML("beforeend",`<p class='${item}'>${itemsArray[i]}</p><br>`)})():document.querySelector(divItems).innerHTML=""}),window.addEventListener("keyup",e=>{(e=>{let selectedItem,items=document.querySelectorAll(`.${item}`);if(e.preventDefault(),document.querySelector(inputSelector)===document.activeElement)if(document.querySelector(`.${item}`)&&13===e.keyCode)document.querySelector(".selected")&&(selectedItem=document.querySelector(".selected")),document.querySelector(`${inputSelector}`).value=selectedItem?selectedItem.innerHTML:items[0].innerHTML,document.querySelector(`${divItems}`).innerHTML="";else if(40===e.keyCode){let selectedIndex;!(selectedItem=document.querySelector(".selected"))&&document.querySelector(`.${item}`)&&items[0].classList.add("selected"),selectedIndex=Array.from(items).indexOf(selectedItem);for(let i=0;i<items.length;i++)items[i].classList.remove("selected");selectedIndex+1===items.length?(document.querySelectorAll(`.${item}`)[0].classList.add("selected"),selectedItem=document.querySelectorAll(`.${item}`)[0]):(document.querySelectorAll(`.${item}`)[selectedIndex+1].classList.add("selected"),selectedItem=document.querySelectorAll(`.${item}`)[selectedIndex+1]),$(divItems).animate({scrollTop:$(selectedItem).offset().top-$(`${divItems} p`).offset().top-50},"fast",function(){})}else if(38===e.keyCode){let selectedIndex;!(selectedItem=document.querySelector(".selected"))&&document.querySelector(`.${item}`)&&(items[0].classList.add("selected"),selectedIndex=0),selectedIndex=Array.from(items).indexOf(selectedItem);for(let i=0;i<items.length;i++)items[i].classList.remove("selected");selectedIndex<=0?(document.querySelectorAll(`.${item}`)[document.querySelectorAll(`.${item}`).length-1].classList.add("selected"),selectedItem=document.querySelectorAll(`.${item}`)[document.querySelectorAll(`.${item}`).length-1]):(document.querySelectorAll(`.${item}`)[selectedIndex-1].classList.add("selected"),selectedItem=document.querySelectorAll(`.${item}`)[selectedIndex-1]),$(divItems).animate({scrollTop:$(selectedItem).offset().top-$(`${divItems} p`).offset().top-50},"fast",function(){})}})(e)})};var ordenarPrioridade=ds=>{let dsCopy=ds.slice(),prioridades=[];for(let i=dsCopy.length-1;i>=0;i--)dsCopy[i].prioridade&&(prioridades.unshift(dsCopy[i]),dsCopy.splice(i,1));return prioridades.concat(dsCopy)},ordenarRecentesPrimeiro=(b,a)=>(b=dataTimeStamp(b._id.toString().substring(0,8),null),(a=dataTimeStamp(a._id.toString().substring(0,8),null))<b?-1:a>b?1:0),ordenarAntigasPrimeiro=(b,a)=>(b=dataTimeStamp(b._id.toString().substring(0,8),null),(a=dataTimeStamp(a._id.toString().substring(0,8),null))>b?-1:a<b?1:0);let cabecalhoDS=ano=>{let cabecalho;cabecalho="emAndamento"===ano?"<h2 class='demandas-cabecalho'>Demandas em curso</h2>":`<h2 class='demandas-cabecalho'>Demandas concluídas em ${ano}</h2>`,document.querySelector(".demandas-cabecalho")?(document.querySelector(".demandas-cabecalho").outerHTML="",document.querySelector(".lista-ds").insertAdjacentHTML("beforebegin",cabecalho)):document.querySelector(".lista-ds").insertAdjacentHTML("beforebegin",cabecalho)};var resumoDsDOM=function(ds){let apagarDS;for(let i=0;i<ds.length;i++)ds[i].data=dataTimeStamp(ds[i]._id.toString().substring(0,8),"DD [de] MMMM [de] YYYY");"recentesPrimeiro"===window.localStorage.getItem("filtro")?ds.sort(ordenarRecentesPrimeiro):"antigasPrimeiro"===window.localStorage.getItem("filtro")&&ds.sort(ordenarAntigasPrimeiro),"true"===window.localStorage.getItem("filtroPrioridades")&&(ds=ordenarPrioridade(ds));var resumos="";document.querySelector(".lista-ds").innerHTML="";for(let i=0;i<ds.length;i++){var prioridade;prioridade=!0===ds[i].prioridade?'<i class="fa fa-exclamation-triangle"></i>':"",apagarDS="aberta"!==ds[i].estado&&"em andamento"!==ds[i].estado?"":"<i class='fa fa-trash deletar-ds'></i>",resumos+=`\n            <div class="ds card" id="${ds[i]._id}">\n                <div class="ds-header">\n                    <div class="prioridade">${prioridade}</div>\n                    <i class="fa fa-cogs"></i>\n                    <span class="span-manutencao">Manutenção</span>\n                    <span class="span-ds">DS</span>\n                </div>\n                <div class="card-descricao">${ds[i].identificacao}</div>\n                <div class="card-data">${ds[i].data}</div>\n\n                <div class="card-solicitante">Solicitante: ${ds[i].solicitante}</div>\n                <div class="card-estado">Estado da DS: ${ds[i].estado}</div>\n                <div class="detalhes-plus">\n                    <i class="fa fa-plus"></i>\n                    <span>detalhes</span>\n                </div>\n                ${apagarDS}\n            </div>\n        `}document.querySelector(".lista-ds").insertAdjacentHTML("beforeend",resumos)},resumoDemanda=function(ds){var prioridade;return prioridade=ds.prioridade?"alta":"normal",`<div class='dados-gerais-demanda'>\n        <p class='ds-solicitante col-lg'> <strong> Solicitante:</strong> ${ds.solicitante}</p>\n        <p class='ds-matricula col-sm'> <strong> Matrícula:</strong> ${ds.matricula}</p>\n        <p class='ds-categoria col-md'> <strong> Categoria:</strong> ${ds.categoria}</p>\n        <p class='ds-cargo col-lg'> <strong> Cargo/Função:</strong> ${ds.cargo}</p>\n        <p class='ds-telefone col-sm'> <strong> Telefone:</strong> ${ds.telefone}</p>\n        <p class='ds-email col-md'> <strong> E-mail:</strong> ${ds.email}</p>\n        <p class='ds-local col-lg'> <strong> Local para contato:</strong> ${ds.localTrabalho}</p>\n        <p class='ds-local col-lg'> <strong> Local do serviço:</strong> ${ds.local}</p>\n        <p class='ds-horarios col-sm'> <strong> Horários:</strong> ${ds.horarios}</p>\n        <p class='ds-unidade col-md'> <strong> Unidade:</strong> ${ds.unidade}</p>\n        <div class='detalhamento-demanda'>\n            <p> <strong> Descrição:</strong> ${ds.descricao}</p>\n            <p> <strong> Observações:</strong> ${ds.obs}</p>                \n        </div>\n        <p class='display-only'> <strong> Estado:</strong> ${ds.estado}</p>\n        <p class='display-only'> <strong> Prioridade:</strong> ${prioridade}</p>\n    </div>`},dsEventosDOM=function(eventos){var eventosDOM="";for(let i=0;i<eventos.length;i++)eventosDOM+=`\n            <div class="evento-ds">\n                <p>${moment(eventos[i].data).format("DD/MM/YYYY[ - ]HH:mm[h]")} | </p><strong>${eventos[i].texto}</strong>\n            </div>\n        `;return eventosDOM},localizarOsDs=idOS=>{let os,ds;var achou=!1;for(let i=0;i<completas.length;i++){for(let j=0;j<completas[i].os.length;j++)if(completas[i].os[j]._id===idOS){os=completas[i].os[j],ds=completas[i],achou=!0;break}if(achou)break}return{ds,os}},dsCompletaDOM=function(ds){document.getElementById("detalhes-demanda").innerHTML="";let hidden,apagarOS,eventos=dsEventosDOM(ds.eventos),os="",osPrint="",fotos="",imagensDiv="";hidden="aberta"!==ds.estado&&"em andamento"!==ds.estado?"hidden opacidade-zero":"";for(let i=0;i<ds.os.length;i++)apagarOS=ds.os[i].dataFinalizacao?"":`<i id='deletar_ordem_${ds.os[i]._id}' data-demanda='${ds._id}' class="fa fa-trash deletar-os "></i>`,os+=`\n        <div class="os card display-only" id="${ds.os[i]._id}">\n            <div class="os-header">\n                <div class="span-oficina">${ds.os[i].oficina}</div>\n                <i class="fa fa-cogs"></i>\n                <span class="span-os">OS</span>\n            </div>\n            <div class="card-os-id">${ds.os[i]._id}</div>\n            <div class="card-data">aberta em: ${moment(ds.os[i].dataAbertura).format("DD/MM/YYYY")}</div>\n            <div class="os-descricao">${ds.os[i].descricao.substr(0,75)}...</div>\n            <div class="os-estado">\n            \n            </div>\n            ${apagarOS}\n            <div class="os-data-finalizacao"></div>\n        </div>`,osPrint+=`<div class='os-print'>\n\n            <div class="ds-os-print-id">\n                <p>ID: ${ds.os[i]._id}</p>\n            </div>\n            <div class="ds-os-print-oficina">\n                <p>Oficina: ${ds.os[i].oficina}</p>\n            </div> \n            <div class="ds-os-print-encarregado">\n                <p>Encarregado: ${ds.os[i].encarregado}</p>\n            </div>\n        </div>`;if(ds.fotos)for(let i=0;i<ds.fotos.length;i++)imagensDiv='\n            <div class="demanda-fotos">\n            <h2><strong>Imagens</strong></h2>\n            </div>',fotos+=`\n            <img class="imagens-ds" src="/img/manutencao/${ds.fotos[i]}">\n            `;var detalhes=`\n        <div class="manutencao-detalhes-ds janela hidden opacidade-zero" id="detalhes-${ds._id}">\n            <div class="cabecalho">\n                <h2 class="header screen">Detalhamento da demanda:</h2>\n                <h2 class="header print">Oficinas de manutenção predial<br><span>Demanda de Serviço ${ds._id}<br>Data de abertura: ${dataTimeStamp(ds._id.toString().substring(0,8),"DD MMM YYYY")} </span></h2>\n            </div>\n            <div class="ds-comando-div display-only">\n                <div class="button-editar btn-acao ${hidden}"><a href="/manutencao/editar/DS/${ds._id}">\n                    <i class="fa fa-pencil" aria-hidden="true"></i>\n                    <span>editar DS</span></a>\n                </div>\n                <div class="button-imprimir btn-acao button-imprimir-ds">\n                    <i class="fa fa-print" aria-hidden="true"></i>\n                    <span>imprimir DS</span>\n                </div>\n            </div>\n            <div class="div-dados-gerais">\n                <h2><strong>Dados gerais da demanda</strong></h2>\n                ${resumoDemanda(ds)}\n            </div>\n            <div class="detalhes-os-${ds._id}">\n                <h2><strong> Ordens de Serviço</strong></h2>\n                <a href="/manutencao/novaOS/${ds._id}">\n                    <div class="display-only btn-acao button-nova ${hidden}">\n                        <i class="fa fa-plus-circle" aria-hidden="true"></i>\n                        <span>nova OS</span>\n                    </div>\n                </a>\n                <div class="div-lista-os card-container">\n                    <div class="lista-os card-div">\n                    </div>\n                </div>\n                <div class="print lista-os-print"></div>\n            </div>\n            <div class='display-only'>\n                ${imagensDiv}\n            </div>\n            <div class="display-only detalhes-eventos-${ds._id}">\n            <h2><strong>Eventos</strong></h2>\n            <div class="btn-acao btn-novo-log-gerente display-only ${hidden}"><span>inserir mensagem</span></div>\n            <div class="overlay-novo-log-gerente hidden opacidade-zero display-only">\n                <div class="div-novo-log-gerente  formulario ">\n                    <span class="fechar-janela">X</span>\n                    <h2>Escolha uma das mensagens abaixo ou insira uma mensagem personalizada:</h2>\n                    <div>\n                        <input type="radio" class="input-novo-log-gerente" name="msg" id="material-requerente" value="Aguardando material, a ser fornecido pelo requerente">\n                        <label for="material-requerente"><span></span>Aguardando material, a ser fornecido pelo requerente</label>\n                \n                    </div>\n                    <div>\n                        <input type="radio" class="input-novo-log-gerente" name="msg" id="material-decania" value="Aguardando material, a ser fornecido pela Decania do CCS">\n                        <label for="material-decania"><span></span>Aguardando material, a ser fornecido pela Decania do CCS</label>            \n                    </div>\n                    <div>\n                        <label for="messagem-customizada">\n                            <p>mensagem customizada</p>\n                        </label>\n                        <br>\n                        <input type="text" class="input-novo-log-gerente" name="mensagem-customizada" id="mensagem-customizada">\n                    </div>\n                    <div>\n                        <button class="submit-novo-log-gerente">enviar mensagem</button>\n                    </div>\n                </div>\n            </div>\n                <div class="lista-eventos">\n                </div>\n            </div>\n            <div class='finalizacao-demanda print'>\n                <h2>Finalização da demanda</h2>\n                <div class='ds-status'>\n                    <p>Status da demanda:</p>\n                    <div class='ds-status-opcoes'>\n                        <span><div class="check"></div>Atendida integralmente</span>\n                        <span><div class="check"></div>Atendida Parcialmente</span>\n                        <span><div class="check"></div>Não atendida </span>\n                    </div>\n                </div>\n                <div class='ds-consideracoes'>\n                    <p class='label'>considerações finais</p>\n                    <div></div>\n                </div>\n                <div class='ds-responsavel'>\n                    <p class='label'>responsável pela finalização</p>\n                    <div></div>\n                </div>\n            </div>\n            <div class="button-div display-only">\n                <button id="button-fechar-detalhes" class=" button-fechar">voltar</button>\n            </div>\n        </div>\n    `;document.getElementById("detalhes-demanda").insertAdjacentHTML("beforeend",detalhes),document.getElementById("detalhes-demanda").insertAdjacentHTML("beforeend",'<div class="janela manutencao-editar-os hidden opacidade-zero"></div>'),document.querySelector(".lista-eventos").insertAdjacentHTML("beforeend",eventos),document.querySelector(".lista-os").insertAdjacentHTML("beforeend",os),document.querySelector(".lista-os-print").insertAdjacentHTML("beforeend",osPrint),document.querySelector(".lista-os").insertAdjacentHTML("beforeend",'<div class="card placeholder-div"></div>'),imagensDiv&&document.querySelector(".demanda-fotos").insertAdjacentHTML("beforeend",`<div>${fotos}</div>`);for(let i=0;i<document.querySelectorAll(".card.os").length;i++)atualizaEstadoOs(ds.os[i]);document.querySelector(".btn-novo-log-gerente").addEventListener("click",()=>{variaveisGlobais.controlarVisibilidade("exibir",".overlay-novo-log-gerente")}),document.querySelector(".overlay-novo-log-gerente").addEventListener("click",async e=>{if(e.target.classList.contains("fechar-janela"))variaveisGlobais.controlarVisibilidade("ocultar",".overlay-novo-log-gerente",500);else if("mensagem-customizada"===e.target.id)document.getElementById("material-decania").checked=!1,document.getElementById("material-requerente").checked=!1;else if("radio"===e.target.type)document.getElementById("mensagem-customizada").value="";else if(e.target.classList.contains("submit-novo-log-gerente")){let inputs=document.querySelectorAll(".input-novo-log-gerente"),encontrou=!1;for(let i=0;i<inputs.length;i++)if("radio"===inputs[i].type&&inputs[i].checked||"text"===inputs[i].type&&""!==inputs[i].value&&void 0!==inputs[i].value){variaveisGlobais.controlarVisibilidade("ocultar",".div-novo-log-gerente",500),variaveisGlobais.exibirMensagem("<h2>Salvando sua mensagem...</h2><br> <img src='/img/loading.svg'>",2e4,"Histórico da DS"),variaveisGlobais.controlarVisibilidade("ocultar",".overlay-novo-log-gerente",500);let nomeGerente=document.querySelector(".mensagens-login").innerHTML.split(" ").pop();nomeGerente=nomeGerente.slice(0,nomeGerente.length-1),await logAdm({mensagem:`${nomeGerente}: `+inputs[i].value,id:ds._id}),atualizarDS(ds._id,"atualizar"),"radio"===inputs[i].type?inputs[i].checked=!1:inputs[i].value="",encontrou=!0;break}encontrou?dsCompletaDOM(ds):variaveisGlobais.exibirMensagem("<h2>Selecione uma mensagem padrão ou escreva sua mensagem personalizada</h2>",3e3,"Histórico da DS")}})},inserirCamposSelecao=function(nome,tipo,array,seletor,posicao){var html="";for(let i=0;i<array.length;i++)html+=`<div>\n            <input type=${tipo} name="${nome}" id="${nome}${i}" value="${array[i]}">\n            <label for="${nome}${i}"><span></span>${array[i]}</label>\n        </div>`;document.querySelector(seletor).insertAdjacentHTML(posicao,html)},inserirMateriais=function(){let material,total=document.querySelectorAll(".input-material-div").length;material=`\n    <div class="input-material-div">\n        <div class="input-material">\n            <label for="nomeMaterial${total}">material</label>\n            <input type="text" name="matNome[]" id="nomeMaterial${total}">\n        </div>\n        <div class="input-material">\n            <label for="qtdMaterial${total}">quant</label>\n            <input type="number" name="matQuant[]" id="qtdMaterial${total}" value="1" min="1">\n        </div>        \n        <i class="fa fa-times-circle"></i>\n    </div>`,document.querySelector(".os-materiais").insertAdjacentHTML("afterbegin",material),document.getElementById(`nomeMaterial${total}`).focus()},recuperarMateriais=function(nome,quant){let materiaisExistentesDOM="";for(let i=0;i<os.matNome.length;i++)materiaisExistentesDOM+=`\n        <div class="input-material-div">\n            <div class="input-material">\n                <label for="nomeMaterial${i}">material</label>\n                <input type="text" name="matNome[]" id="nomeMaterial${i}" value="${nome[i]}">\n            </div>\n            <div class="input-material">\n                <label for="qtdMaterial${i}">quant</label>\n                <input type="number" name="matQuant[]" id="qtdMaterial${i}" value="${quant[i]}">\n            </div>        \n            <i class="fa fa-times-circle display-only"></i>\n        </div>`;materiaisExistentesDOM+='\n    <div class="input-material-div placeholder">   \n        <div class="input-material">\n            <label>material</label>\n            <input type="text" name="matNome[]" value="">\n        </div>\n        <div class="input-material">\n            <label>quant</label>\n            <input type="number" name="matQuant[]" value=0>           \n        </div>\n    </div>\n    <div class="input-material-div placeholder">   \n        <div class="input-material">\n            <label>material</label>\n            <input type="text" name="matNome[]" value="">\n        </div>\n        <div class="input-material">\n            <label>quant</label>\n            <input type="number" name="matQuant[]" value=0>           \n        </div>\n    </div>',document.querySelector(".os-materiais").insertAdjacentHTML("beforeend",materiaisExistentesDOM)},marcarCheckbox=function(DOMArray,objectArray){for(let i=0;i<DOMArray.length;i++)for(let j=0;j<objectArray.length;j++)if(DOMArray[i].value===objectArray[j]){DOMArray[i].checked=!0;break}},atualizaEstadoOs=function(os){var estado,icon,finalizacao;void 0===os.executada||"neutro"===os.executada?(estado="em andamento",icon='<i class="fa fa-wrench"></i>'):!1===os.executada?(estado="não realizado",icon='<i class="fa fa-times-circle"></i>'):!0===os.executada&&(estado="serviço concluído em ",icon='<i class="fa fa-check-circle"></i>'),finalizacao=void 0===os.dataFinalizacao||!1===os.executada?"":moment(os.dataFinalizacao).format("DD-MM-YYYY"),document.querySelector(`#${os._id} .os-estado`).innerHTML=`${estado}${finalizacao}${icon}`},dataTimeStamp=function(codigo,formato){return moment(new Date(1e3*parseInt(codigo,16))).format(formato)},camposDinamicosOs=function(){inserirCamposSelecao("oficina","radio",oficinas,".os-oficinas","beforeend"),document.querySelector(".manutencao-abrir-os")||recuperarMateriais(os.matNome,os.matQuant),document.querySelector(".os-materiais-container").addEventListener("click",function(e){e.target.classList.contains("btn-inserir-materiais")?inserirMateriais():e.target.classList.contains("fa-times-circle")&&e.target.parentElement.remove()})},estatisticasDOM=async function(){var html,unidadesContabilizadas,dadosDS=await recuperarDS("estatisticas"),dadosOS=[],osFinalizadas=0,osFalhas=0,unidades=[],chamadosPorUnidade="";for(let i=0;i<dadosDS.length;i++)for(let j=0;j<dadosDS[i].os.length;j++)dadosOS.push(dadosDS[i].os[j]);for(let i=0;i<dadosOS.length;i++)dadosOS[i].executada?osFinalizadas++:0==dadosOS[i].executada&&osFalhas++;for(let i=0;i<dadosDS.length;i++)unidades.push(dadosDS[i].unidade);unidadesContabilizadas=unidades.reduce((unidades,unidade)=>(unidade in unidades?unidades[unidade]++:unidades[unidade]=1,unidades),{});for(let i=0;i<Object.keys(unidadesContabilizadas).length;i++)chamadosPorUnidade+=`<li>${[Object.keys(unidadesContabilizadas)[i]]}: <strong>${unidadesContabilizadas[Object.keys(unidadesContabilizadas)[i]]}</strong></li>`;html=`\n        <p><strong>Chamados recebidos</strong><br>\n        Total: ${dadosDS.length}<br>\n        <p><strong>Chamados por Unidade</strong></p>\n        <div class=chamados-por-unidade><ul>${chamadosPorUnidade}</ul></div>\n        <p><strong>Demandas por estado</strong><br>\n        ${contagemArray(["aberta","em andamento","atendida","atendida parcialmente","não atendida","fora de escopo"],dadosDS,"estado")}</p>\n        <p><strong>Categorias</strong><br>\n        ${contagemArray(categoriasFuncionais,dadosDS,"categoria")}</p>\n        <p><strong>Ordens de Serviço</strong><br>\n        Criadas: ${dadosOS.length}<br>\n        Finalizadas: ${osFinalizadas}<br>\n        Não realizadas: ${osFalhas}</p>\n        <p><strong>Oficinas</strong><br>\n        ${contagemArray(oficinas,dadosOS,"oficina")}</p>\n        `,document.querySelector(".estatisticas-container").innerHTML=html},contagemArray=function(array,colecao,propriedade){let html="";for(let i=0;i<array.length;i++){let contador=0;for(let j=0;j<colecao.length;j++)colecao[j][propriedade]&&colecao[j][propriedade]===array[i]&&contador++;html+=`${array[i]}: ${contador}<br>`}return html};let buscarDemandas=()=>{let input=document.querySelector(".filtrar-demandas--input"),cards=document.querySelectorAll(".card"),filtradas=[];for(let i=0;i<resumo.length;i++){if(input.value===resumo[i]._id){filtradas.push(resumo[i]._id);break}resumo[i].identificacao.toUpperCase().includes(input.value.toUpperCase())?filtradas.push(resumo[i]._id):resumo[i].solicitante.toUpperCase().includes(input.value.toUpperCase())?filtradas.push(resumo[i]._id):resumo[i].estado.toUpperCase().includes(input.value.toUpperCase())&&filtradas.push(resumo[i]._id)}for(let i=0;i<cards.length;i++)cards[i].classList.remove("hidden");for(let i=0;i<cards.length;i++)filtradas.includes(cards[i].id)||cards[i].classList.add("hidden")};document.addEventListener("DOMContentLoaded",async function(){if(document.querySelector(".manutencao-gerenciador")){resumo=await recuperarDS("resumo"),"antigasPrimeiro"===window.localStorage.getItem("filtro")?document.getElementById("radio1").checked=!0:"recentesPrimeiro"===window.localStorage.getItem("filtro")&&(document.getElementById("radio2").checked=!0),"true"===window.localStorage.getItem("filtroPrioridades")?document.getElementById("checkbox1").checked=!0:document.getElementById("checkbox1").checked=!1,resumoDsDOM(resumo);var ano=(new Date).getFullYear(),filtroAno='<option value="emAndamento">Em andamento</option>';for(let a=ano;a>ano-5;a--)filtroAno+=`<option value="${a}">Concluídas em ${a}</option>`;document.getElementById("filtro-ano-ds").insertAdjacentHTML("beforeend",filtroAno),document.addEventListener("keyup",e=>{13===e.keyCode&&document.querySelector(".filtrar-demandas--input")===document.activeElement&&buscarDemandas(),27===e.keyCode&&document.querySelector(".filtrar-demandas--input")===document.activeElement&&(document.querySelector(".filtrar-demandas--input").value="",buscarDemandas())}),document.querySelector(".filtrar-demandas").addEventListener("click",function(e){e.target===document.querySelector(".filtrar-demandas--btn")?buscarDemandas():e.target===document.querySelector(".limpar-busca")&&(document.querySelector(".filtrar-demandas--input").value="",buscarDemandas())}),document.querySelector(".lista-ds").addEventListener("click",async function(e){if(e.target.classList.contains("ds")){var index,jaExiste=!1;for(let i=0;i<completas.length;i++)if(e.target.id===completas[i]._id){jaExiste=!0,index=i;break}if(jaExiste)dsCompletaDOM(completas[index]);else{var dsCompleta=await recuperarDS("completa",e.target.id);dsCompleta||(dsCompleta=await recuperarDS("completaConcluidas",e.target.id)),completas.push(dsCompleta),dsCompletaDOM(dsCompleta)}variaveisGlobais.controlarVisibilidade("exibir","#overlay"),variaveisGlobais.controlarVisibilidade("exibir","#detalhes-"+e.target.id),body.classList.add("fixo")}}),document.getElementById("filtro-ano-ds").addEventListener("change",async function(e){let ano=document.getElementById("filtro-ano-ds").value,anoAtual=(new Date).getFullYear();cabecalhoDS(ano),resumo="emAndamento"==ano?await recuperarDS("resumo"):ano==anoAtual?await recuperarDS("resumo","",anoAtual,!0):await recuperarDS("resumoConcluidas","",ano),resumoDsDOM(resumo)}),document.querySelector(".filtro-ordenacao-ds").addEventListener("click",e=>{"checkbox1"==e.target.id&&e.target.checked?(window.localStorage.setItem("filtroPrioridades","true"),resumoDsDOM(resumo)):"checkbox1"!=e.target.id||e.target.checked?"radio"===e.target.type&&(window.localStorage.setItem("filtro",e.target.value),resumoDsDOM(resumo)):(window.localStorage.setItem("filtroPrioridades","false"),resumoDsDOM(resumo))}),document.getElementById("div-demandas").addEventListener("click",function(e){if("button-fechar-detalhes"===e.target.id?(variaveisGlobais.controlarVisibilidade("ocultar",`#${e.target.parentElement.parentElement.id}`),variaveisGlobais.controlarVisibilidade("ocultar","#overlay"),body.classList.remove("fixo")):"btn-fechar-os-editar"===e.target.id&&(osEditada={},os={},variaveisGlobais.controlarVisibilidade("ocultar",".manutencao-editar-os")),e.target.classList.contains("button-imprimir")&&(e.target.classList.contains("button-imprimir-os")?(document.querySelector(".manutencao-detalhes-ds").classList.add("display-only"),document.getElementsByTagName("title")[0].innerHTML=document.querySelectorAll("h2.header span")[1].innerHTML.split("<br>")[0],print(),document.getElementsByTagName("title")[0].innerHTML="Chamados de manutenção | CCS-UFRJ",document.querySelector(".manutencao-detalhes-ds").classList.remove("display-only")):e.target.classList.contains("button-imprimir-visita")?(document.getElementsByTagName("title")[0].innerHTML=document.querySelectorAll("h2.header span")[1].innerHTML.split("<br>")[0],document.querySelector(".manutencao-detalhes-ds").classList.add("display-only"),document.querySelector(".os-materiais-container").classList.add("display-only"),document.querySelector(".os-epi").classList.add("display-only"),document.querySelector(".os-descricao-div").classList.add("visita"),document.querySelector(".os-obs").classList.add("visita"),document.querySelector(".visita-preliminar").classList.add("visita"),document.querySelector(".vistos-visita").classList.add("visita"),document.querySelector(".finalizacao-super-div").classList.add("display-only"),document.querySelector(".finalizacao-super-div").classList.add("visita"),print(),document.getElementsByTagName("title")[0].innerHTML="Chamados de manutenção | CCS-UFRJ",document.querySelector(".manutencao-detalhes-ds").classList.remove("display-only"),document.querySelector(".os-materiais-container").classList.remove("display-only"),document.querySelector(".os-epi").classList.remove("display-only"),document.querySelector(".os-descricao-div").classList.remove("visita"),document.querySelector(".os-obs").classList.remove("visita"),document.querySelector(".visita-preliminar").classList.remove("visita"),document.querySelector(".vistos-visita").classList.remove("visita"),document.querySelector(".finalizacao-super-div").classList.remove("display-only"),document.querySelector(".finalizacao-super-div").classList.remove("visita")):e.target.classList.contains("button-imprimir-ds")&&(document.querySelector(".manutencao-editar-os").classList.add("display-only"),document.getElementsByTagName("title")[0].innerHTML=document.querySelectorAll("h2.header span")[0].innerHTML.split("<br>")[0],print(),document.getElementsByTagName("title")[0].innerHTML="Chamados de manutenção | CCS-UFRJ",document.querySelector(".manutencao-editar-os").classList.remove("display-only"))),e.target.classList.contains("deletar-ds")){variaveisGlobais.exibirMensagem('\n                <div id=\'excluir-demanda-div\'>\n                    <h2>A demanda será apagada/arquivada. Determinar o motivo:</h2>\n                    <div id="div-btn-apagar-demanda">                        \n                        <button class="excluir-demanda criada-indevidamente">criada indevidamente</button>\n                        <button class="excluir-demanda fora-de-escopo">fora de escopo</button>                   \n                    </div>\n\n                    <div class="button-div display-only">\n                        <button class="button-fechar" style=\'position:unset;\'>voltar</button>\n                    </div>\n                </div>',null),document.getElementById("excluir-demanda-div").addEventListener("click",async evt=>{if(evt.target.classList.contains("button-fechar"))variaveisGlobais.controlarVisibilidade("ocultar","#mensagens-genericas");else if(evt.target.classList.contains("criada-indevidamente")){document.getElementById("excluir-demanda-div").innerHTML="<img src='/img/loading.svg'>",await deletarDS(e.target.parentElement.id,"eliminar"),await atualizarDS(e.target.parentElement.id,"deletar");let resumo=await recuperarDS("resumo");resumoDsDOM(resumo)}else if(evt.target.classList.contains("fora-de-escopo")){document.getElementById("excluir-demanda-div").innerHTML="<img src='/img/loading.svg'>",await deletarDS(e.target.parentElement.id,"arquivar"),await atualizarDS(e.target.parentElement.id,"atualizar");let resumo=await recuperarDS("resumo");resumoDsDOM(resumo)}})}}),document.getElementById("btn-estatisticas").addEventListener("click",function(e){document.getElementById("div-estatisticas").classList.toggle("aberto"),document.getElementById("div-estatisticas").classList.contains("aberto")&&estatisticasDOM(),body.classList.toggle("fixo")}),document.getElementById("detalhes-demanda").addEventListener("click",async function(e){if(e.target.classList.contains("imagens-ds")&&e.target.classList.toggle("exibir-full"),e.target.classList.contains("card")&&e.target.classList.contains("os")){variaveisGlobais.controlarVisibilidade("exibir",".manutencao-editar-os"),os=localizarOsDs(e.target.id).os,ds=localizarOsDs(e.target.id).ds;var editarOsHeader,readOnly,hidden;"neutro"===os.executada||void 0===os.executada?(editarOsHeader="<h2 class='screen'>Edite a ordem de serviço, preenchendo os campos abaixo:</h2>",readOnly="",hidden=""):(editarOsHeader=`<h2 class="screen">Ordem de serviço ${os._id} finalizada</h2>`,readOnly="readonly",hidden="hidden");var form=`\n                <div class="outerDiv ${readOnly}">\n                    <div class="cabecalho cabecalho-os print">                        \n                        <h2 class="header print">Oficinas de manutenção predial<br><span>Ordem de Serviço ${os._id}<br>Data de abertura: ${moment(os.dataAbertura).format("DD MMM YYYY")}<br>Oficina: ${os.oficina}<br>Encarregado: ${os.encarregado} </span></h2>\n                    </div>\n                    <h2 class="header display-only">Edição/Finalização de OS</h2>\n                    <div class="os-imprimir-div display-only">                        \n                        <div class="btn-acao button-imprimir button-imprimir-visita">\n                            <i class="fa fa-print" aria-hidden="true"></i>\n                            <span>visita</span>\n                        </div>\n                        <div class="btn-acao button-imprimir button-imprimir-os">\n                            <i class="fa fa-print" aria-hidden="true"></i>\n                            <span>imprimir OS</span>\n                        </div>\n                    </div>\n                    <h2 class="print subtitle os-dados-demanda-print">Dados da Demanda</h2>\n                    ${editarOsHeader}\n                    <div class="print">\n                        ${resumoDemanda(ds)}\n                    </div>\n                    <div class="formulario ${readOnly}" id="form-os">\n                        <div class="hidden">\n                            <input type="text" name="idOS" id="idOS" value="${os._id}">\n                        </div>\n                        <div class="os-oficinas display-only">\n                            <label for="oficina">\n                                <p>Oficina:</p>\n                            </label>\n                        </div>\n                        <div class="os-encarregado display-only">\n                            <label for="encarregado"><p>Encarregado:</p></label>\n                            <input type="text" name="encarregado" id="encarregado" >\n                        </div>\n                        <h2 class="print visita-preliminar">Visita preliminar</h2>\n                        <div class="os-descricao-div">\n                            <label class="label-os" for="descricao"><p>Descrição do problema:</p></label>\n                            <textarea class="display-only" name="descricao" id="descricao" required></textarea><br>\n                            <div class="print"><p>${os.descricao}</p></div>\n                        </div>\n                        <div id="os-obs" class="os-obs">\n                            <label class="label-os" for="obs"><p>Observações:</p></label>\n                            <textarea class="display-only" name="obs" id="obs"></textarea><br>\n                            <div class="print"><p>${os.obs}</p></div>\n                        </div>\n                        <div class="os-materiais-container"">\n                            <label class="label-os" for="materiais">\n                                <p>Materiais:</p>\n                            </label>\n                            <div class="btn-acao btn-inserir-materiais display-only">\n                                <i class="fa fa-plus-circle" aria-hidden="true"></i>\n                                <span>inserir material</span>\n                            </div>\n                            <div class="os-materiais"></div>\n                        </div>\n                        <div class="os-epi">\n                            <label class="label-os" for="epi"><p>EPIs:</p></label>\n                            <textarea class="display-only" name="epi" id="epi"></textarea><br>\n                            <div class="print"><p>${os.epi}</p></div>\n                        </div>                        \n                        <h2 class="centralizado os-finalizacao display-only">Finalização da Ordem de Serviço</h2>\n                        <div class="block finalizacao-super-div">\n                            <h2 class="print subtitle finalizacao-titulo">Finalização da Ordem de Serviço</h2>\n                            <div class="os-finalizacao-div">\n                                <div class="os-finalizacao-container">\n                                    <label class="label-os" for="executada"><p>Serviço realizado?</p></label><br>\n                                    <select class="display-only" name="executada" id="executada">\n                                        <option disabled value="neutro">Selecione uma opção:</option>\n                                        <option value=true>sim</option>\n                                        <option value=false>não</option>\n                                    </select>\n                                    <div class="print executadaSN">\n                                        <div>\n                                            <div class="check"></div><span>Sim</span> \n                                        </div>\n                                        <div>\n                                            <div class="check"></div><span>Não</span> \n                                        </div>\n                                    </div>\n                                </div>\n                                <div class="os-dataFinalizacao">\n                                    <label class="label-os" for="dataFinalizacao"><p>Data de Finalização da Ordem:</p></label>\n                                    <input class="display-only" type="date" name="dataFinalizacao" id="dataFinalizacao">\n                                    <div class="print input-print"></div>\n                                </div>\n                                <div class="os-executor">\n                                    <label class="label-os" for="executor"><p>executor:</p></label>\n                                    <input class="display-only" type="text" name="executor" id="executor">\n                                    <div class="print input-print"></div>\n                                </div>                        \n                                <div class="os-consideracoes-finais">\n                                    <label class="label-os" for="consideracoes"><p>Considerações finais:</p></label>\n                                    <textarea class="display-only" name="consideracoes" id="consideracoes" ></textarea><br>\n                                    <div class="print input-print big"></div>\n                                </div>\n                            </div>                        \n                            <div class="print os-vistos-div">\n                                <label><p>Vistos:</p></label>\n                                <div class="vistos">\n                                    <div>\n                                        <label>Solicitante</label>\n                                    </div>\n                                    <div>\n                                        <label>Emissor</label>\n                                    </div>\n                                    <div>\n                                        <label>Executante</label>\n                                    </div>\n                                    <div>\n                                        <label>Encarregado</label>\n                                    </div>\n                                    \n                                </div>  \n                            </div>\n                        </div>\n                        <div class="print vistos-visita os-vistos-div">\n                        <label><p>Vistos:</p></label>\n                        <div class="vistos">\n                            <div>\n                                <label>Solicitante</label>\n                            </div>                            \n                            <div>\n                                <label>Executante</label>\n                            </div>\n                            <div>\n                                <label>Encarregado</label>\n                            </div>                            \n                        </div>  \n                    </div>\n                        <div class="display-only">\n                            <button id="btn-submit" class="botao-submit ${hidden}">Editar</button>\n                        </div>\n                    </div>\n                    <button id="btn-fechar-os-editar" class="button-fechar display-only">voltar</button>\n                </div>\n                `;document.querySelector(".manutencao-editar-os").innerHTML=form,camposDinamicosOs(),epi=document.getElementById("epi"),executor=document.getElementById("executor"),encarregado=document.getElementById("encarregado"),consideracoes=document.getElementById("consideracoes"),obs=document.getElementById("obs"),descricao=document.getElementById("descricao"),dataFinalizacao=document.getElementById("dataFinalizacao");var oficinasInput=document.querySelectorAll("input[name='oficina']");for(let i=0;i<oficinasInput.length;i++)oficinasInput[i].value===os.oficina?oficinasInput[i].checked=!0:oficinasInput[i].checked=!1;encarregado.value=os.encarregado,epi.value=os.epi,void 0===os.executada&&(os.executada="neutro"),descricao.value=os.descricao,dataFinalizacao.value=os.dataFinalizacao,os.obs?obs.value=os.obs:obs.value="",document.querySelector(`#executada option[value="${os.executada}"]`).selected=!0,os.executor?executor.value=os.executor:executor.value="",os.consideracoes?consideracoes.value=os.consideracoes:consideracoes.value=""}if("btn-submit"===e.target.id){osEditada._id=os._id,osEditada.idDemanda=ds._id,osEditada.encarregado=encarregado.value,osEditada.matNome=[],osEditada.matQuant=[];for(let i=0;i<document.querySelectorAll(".input-material-div").length;i++)""!==document.querySelectorAll('input[name="matNome[]"]')[i].value&&Number(document.querySelectorAll('input[name="matQuant[]"]')[i].value)>0&&(osEditada.matNome.push(document.querySelectorAll('input[name="matNome[]"]')[i].value),osEditada.matQuant.push(Number(document.querySelectorAll('input[name="matQuant[]"]')[i].value)));for(osEditada.epi=epi.value,osEditada.descricao=descricao.value,osEditada.obs=obs.value,i=0;i<document.querySelectorAll("#executada option").length;i++)if(!0===document.querySelectorAll("#executada option")[i].selected){"neutro"===document.querySelectorAll("#executada option")[i].value?osEditada.executada="neutro":"true"===document.querySelectorAll("#executada option")[i].value?osEditada.executada=!0:osEditada.executada=!1;break}""!==dataFinalizacao.value&&(osEditada.dataFinalizacao=moment(dataFinalizacao.value).toDate()),osEditada.executor=executor.value,osEditada.consideracoes=consideracoes.value;for(let i=0;i<ds.os.length;i++)if(osEditada.dsFinalizada=!0,ds.os[i]._id!==osEditada._id&&("neutro"===ds.os[i].executada||void 0===ds.os[i].executada||"neutro"===osEditada.executada||void 0===osEditada.executada)){osEditada.dsFinalizada=!1;break}if(osEditada.dsFinalizada){var todas=!0,nenhuma=!0;for(let i=0;i<ds.os.length;i++)ds.os[i]._id!==osEditada._id?(!1!==ds.os[i].executada&&"neutro"!==ds.os[i].executada&&!1!==osEditada.executada||(todas=!1),!0!==ds.os[i].executada&&!0!==osEditada.executada||(nenhuma=!1),(todas||nenhuma)&&!1):1===ds.os.length&&!1===osEditada.executada?(todas=!1,!1):1===ds.os.length&&(nenhuma=!1,!1);osEditada.dsEstado=todas?"atendida":nenhuma?"não atendida":"atendida parcialmente"}if(moment(osEditada.dataFinalizacao).isBefore(moment(os.dataAbertura).hour(0).minutes(0).seconds(0).milliseconds(0))||moment(new Date).isBefore(moment(osEditada.dataFinalizacao)))variaveisGlobais.exibirMensagem("A data de finalização deve ser posterior à data de abertura da OS e anterior ao dia de hoje",4e3,"Data incorreta");else if("neutro"===osEditada.executada||void 0===osEditada.executada||osEditada.executor&&osEditada.encarregado&&osEditada.descricao&&void 0!==osEditada.dataFinalizacao)if("neutro"!==osEditada.executada&&void 0!==osEditada.executada||!(osEditada.executor||""!==osEditada.dataFinalizacao&&void 0!==osEditada.dataFinalizacao)){if("neutro"===osEditada.executada&&!osEditada.executor&&!osEditada.consideracoes&&(!osEditada.dataFinalizacao||""===osEditada.dataFinalizacao)||"neutro"!==osEditada.executada&&osEditada.encarregado&&osEditada.descricao&&(osEditada.executor||""!==osEditada.dataFinalizacao)){await editarOS(osEditada);var refreshResumoDemandas=await recuperarDS("resumo");resumoDsDOM(refreshResumoDemandas),dsCompletaDOM(ds),variaveisGlobais.exibirMensagem("<h3>Salvamento concluído</h3>",2e3),setTimeout(function(){variaveisGlobais.controlarVisibilidade("ocultar",".manutencao-editar-os"),body.classList.remove("fixo"),""!==osEditada.dataFinalizacao&&variaveisGlobais.controlarVisibilidade("ocultar","#overlay")},2e3)}}else variaveisGlobais.exibirMensagem("Para gravar o nome do executor e registrar as considerações finais, é necessário informar se a ordem de serviço foi finalizada",4e3);else variaveisGlobais.exibirMensagem("Para finalizar esta ordem de serviço, é necessário informar o nome do encarregado pela oficina, a descrição do problema, a data de finalização e o nome do executor do serviço",4e3,"Dados ausentes")}if(e.target.classList.contains("deletar-os")){let os,ds;os=localizarOsDs(e.target.id.split("_").pop()).os,ds=localizarOsDs(e.target.id.split("_").pop()).ds;variaveisGlobais.exibirMensagem('\n                <div id=\'excluir-ordem-div\'>\n                    <h2>A ordem será apagada/arquivada. Continuar?</h2>\n                    <div id="div-btn-apagar-demanda">                        \n                        <button class="excluir-ordem">sim</button>                                        \n                    </div>\n                    <div class="button-div display-only">\n                        <button class="button-fechar" style=\'position:unset;\'>voltar</button>\n                    </div>\n                </div>',null),document.getElementById("excluir-ordem-div").addEventListener("click",async evt=>{if(evt.target.classList.contains("button-fechar"))variaveisGlobais.controlarVisibilidade("ocultar","#mensagens-genericas");else if(evt.target.classList.contains("excluir-ordem")){document.getElementById("excluir-ordem-div").innerHTML="<img src='/img/loading.svg'>",await deletarOS(e.target.id.split("_").pop(),e.target.dataset.demanda);let resumo=await recuperarDS("resumo");resumoDsDOM(resumo),dsCompletaDOM(ds),body.classList.remove("fixo")}})}}),document.addEventListener("scroll",function(){document.querySelector(".footer").getBoundingClientRect().top>window.innerHeight?(btnEstatisticas.style.bottom="10px",btnEstatisticas.style.top="unset"):(btnEstatisticas.style.top=document.querySelector(".footer").getBoundingClientRect().top-130+"px",btnEstatisticas.style.bottom="unset")})}else if(document.querySelector(".manutencao-editar-ds")){var id=window.location.href.split("/").pop(),ds=await recuperarDS("completa",id);document.getElementById("identificacao").value=ds.identificacao,document.getElementById("solicitante").value=ds.solicitante,document.getElementById("matricula").value=ds.matricula,inserirCamposSelecao("categoria","radio",categoriasFuncionais,".ds-categoria","beforeend");var categorias=document.querySelectorAll("input[name='categoria']");for(let i=0;i<categorias.length;i++)categorias[i].value===ds.categoria?categorias[i].checked=!0:categorias[i].checked=!1;document.getElementById("id").value=ds._id,document.getElementById("identificacao").value=ds.identificacao,document.getElementById("unidade").value=ds.unidade,document.getElementById("cargo").value=ds.cargo,document.getElementById("local").value=ds.local,document.getElementById("telefone").value=ds.telefone,document.getElementById("email").value=ds.email,document.getElementById("horarios-disponiveis-manutencao").value=ds.horarios,document.getElementById("descricao").value=ds.descricao,document.getElementById("obs").value=ds.obs,document.querySelector(`#prioridade option[value="${ds.prioridade}"]`).selected=!0}else if(document.querySelector(".manutencao-abrir-ds")){let faltaPreencher;inserirCamposSelecao("categoria","radio",categoriasFuncionais,".ds-categoria","beforeend"),document.getElementById("categoria0").required=!0,autoComplete("#unidade",".div-unidades","unidade",arrayUnidades),document.getElementById("btn-submit").addEventListener("click",function(e){document.querySelector("#unidade")!==document.activeElement&&(faltaPreencher=variaveisGlobais.checarInputs(document.querySelectorAll("#form-ds input[required], #form-ds textarea[required]")))}),$("#form-ds").submit(function(e){e.preventDefault(),faltaPreencher||variaveisGlobais.disabled||document.querySelector("#unidade")===document.activeElement||(variaveisGlobais.clickingOnce(),this.submit())})}else if(document.querySelector(".manutencao-abrir-os"))document.querySelector(".os-materiais-container").classList.add("hidden"),document.querySelector(".os-epi").classList.add("hidden"),camposDinamicosOs(),$("#form-os").submit(function(e){e.preventDefault(),variaveisGlobais.disabled||(variaveisGlobais.clickingOnce(),this.submit())});else if(document.querySelector(".manutencao-acompanhar")){var id=window.location.href.split("/").pop(),ds=await recuperarDS("completa",id),eventos=dsEventosDOM(ds.eventos),listaEventos=document.querySelector(".lista-eventos");listaEventos.insertAdjacentHTML("beforeend",eventos),document.querySelector(".btn-ds-enviar-mensagem").addEventListener("click",async function(e){e.preventDefault(),await logAdm({mensagem:`${ds.solicitante.split(" ").shift()}: ${document.querySelector(".ds-enviar-mensagem").value}`,id:ds._id}),listaEventos.innerHTML="",document.querySelector(".ds-enviar-mensagem").value="",ds=await recuperarDS("completa",id),eventos=dsEventosDOM(ds.eventos),listaEventos.insertAdjacentHTML("beforeend",eventos)})}document.querySelector(".btn-inserir-arquivos")&&document.querySelector(".btn-inserir-arquivos").addEventListener("click",e=>{setTimeout(()=>{document.querySelectorAll(".tipo-arquivo")[0].classList.add("hidden"),document.querySelectorAll("option[value='imagem']")[0].selected=!0},2)})});