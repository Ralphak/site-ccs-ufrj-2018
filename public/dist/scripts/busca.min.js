var url=window.location.href.split("/").pop();url=url.split(/[?&]/);var inputBusca,termoInformado=!1;resultadosPorPagina=10,classificacao=["pagina","noticia","evento","informe","video","foto","depoimento"],classificacaoTemp=[],relacaoTermos="todas",quantidadeNumerosPagina=2,paginaAtual=Number(url[0]),termoDeBusca="",dataDesde=[new Date(2014,0,1),0],dataAte=[new Date,0];var ordenacao={data:-1,titulo:1};for(let i=1;i<url.length;i++){let trechoAtual=url[i].split("=");switch(trechoAtual[0]){case"input-busca":case"input-busca-geral":"+"!==(inputBusca=decodeURIComponent(trechoAtual[1]))&&""!==inputBusca&&(inputBusca=inputBusca.replace(/\+/g," "),termoInformado=!0);break;case"resultadosPorPagina":resultadosPorPagina=Number(trechoAtual[1]);break;case"classificacao":classificacaoTemp.push(trechoAtual[1]);break;case"relacaoTermos":relacaoTermos=trechoAtual[1];break;case"ordenacao":"maisAntigos"===trechoAtual[1]&&(ordenacao.data=1);break;case"dataDesde":0!=trechoAtual[1]&&(dataDesde=moment(new Date).subtract(trechoAtual[1],"months"),dataDesde=[dataDesde._d,trechoAtual[1]]);break;case"dataAte":dataAte=moment(new Date).subtract(trechoAtual[1],"months"),dataAte=[dataAte._d,trechoAtual[1]]}}switch(classificacaoTemp.length>0&&(classificacao=classificacaoTemp),relacaoTermos){case"todas":var stringCache=inputBusca.split(" ");for(let i=0;i<stringCache.length;i++)termoDeBusca+='"'+stringCache[i]+'"';break;case"qualquer":termoDeBusca=inputBusca;break;case"exata":termoDeBusca='"'+inputBusca+'"'}var filtro={natureza:classificacao,data:{$gte:dataDesde[0],$lte:dataAte[0]}},opcoes=JSON.stringify({page:paginaAtual,limit:resultadosPorPagina,sort:ordenacao,populate:"contatos"});termoInformado&&(filtro.$text={$search:termoDeBusca});var recuperarBusca=async function(){await $.ajax({type:"GET",url:"/recuperarBusca",data:{filtro,opcoes,quantidadeNumerosPagina,paginaAtual},dataType:"json"}).done(function(msg){msg&&exibirResultados(msg)}).fail(function(msg){console.log("Fail! "+msg.data)})},exibirResultados=function(retornoBusca){var resultadosHTML;resultadosHTML=0==retornoBusca.resultados.total?`<h2>Não há resultados de pesquisa para o termo "${inputBusca}".</h2>`:`<p>Foram encontrados ${retornoBusca.resultados.total} resultados.</p>`;for(let i=0,docs=retornoBusca.resultados.docs;i<docs.length;i++)resultadosHTML+=`<a href="/conteudos/${docs[i]._id}"><article class="conteudo borda-${docs[i].natureza}">\n            <div class="resultado-header">\n                <h2>${docs[i].titulo}</h2>`,docs[i].data&&(resultadosHTML+=`<span>${docs[i].dataAmigavel}</span>`),resultadosHTML+=`</div>\n            <div class="natureza">\n                <span>${docs[i].natureza}</span>\n            </div>`,docs[i].imagem&&(resultadosHTML+=`<div class="img-news-container">\n                <img src='/img/conteudos/${docs[i]._id}XSm.jpg' alt='${docs[i].titulo}'>\n            </div>`),docs[i].midia&&(resultadosHTML+=`<div class="img-news-container">\n                <i class='resultado-${docs[i].natureza} fa'></i>\n            </div>`),docs[i].texto&&(resultadosHTML+=`<p>${docs[i].texto.substring(0,160).replace(/(<([^>]+)>)/gi," ")}</p>`),resultadosHTML+="</article></a>";document.querySelector(".resultados-container").insertAdjacentHTML("afterbegin",resultadosHTML);var paginasHTML="",urlBusca="?"+window.location.href.split("?").pop();retornoBusca.paginacao.exibirAnterior?paginasHTML+=`<a href="/busca/1${urlBusca}"><div>primeira</div></a>\n            <a href="/busca/${retornoBusca.paginacao.paginaAnterior}${urlBusca}"><i class="fa fa-caret-left"></i></a>`:paginasHTML+='<a><div class="inativo">primeira</div></a>\n            <a class="inativo"><i class="inativo fa fa-caret-left"></i></a>';for(let i=0,paginas=retornoBusca.paginacao.paginas;i<paginas.length;i++)paginasHTML+=`<a href="/busca/${paginas[i].numero}${urlBusca}">\n            <div id="${paginas[i].numero}" class="num-pagina ${paginas[i].paginaAtual}">\n                ${paginas[i].numero}\n            </div></a>`;retornoBusca.paginacao.exibirProxima?paginasHTML+=`<a href="/busca/${retornoBusca.paginacao.proximaPagina}${urlBusca}"><i class="fa fa-caret-right"></i></a>\n            <a href="/busca/${retornoBusca.resultados.pages}${urlBusca}"><div>ultima</div></a>`:paginasHTML+='<a><i class="inativo fa fa-caret-right"></i></a>\n            <a class="inativo"><div>ultima</div></a>',document.getElementById("resultados-busca-paginas").insertAdjacentHTML("beforeend",paginasHTML),"+"!==inputBusca&&(document.getElementById("input-busca").value=inputBusca),document.getElementById("resultadosPorPagina").value=resultadosPorPagina;for(let i=0;i<document.getElementsByName("classificacao").length;i++)for(let j=0;j<classificacao.length;j++)if(document.getElementById("classificacao"+i).value===classificacao[j]){document.getElementById("classificacao"+i).checked=!0;break}for(let i=0;i<document.getElementsByName("relacaoTermos").length;i++)if(document.getElementById("relacaoTermos"+i).value===relacaoTermos){document.getElementById("relacaoTermos"+i).checked=!0;break}1==ordenacao.data?document.getElementById("ordenacao1").checked=!0:document.getElementById("ordenacao0").checked=!0,document.getElementById("dataDesde").value=dataDesde[1],document.getElementById("dataAte").value=dataAte[1]},naturezas=document.querySelectorAll("#classificacao div > input"),desmarcados=function(indexInicio){var contador=0;for(let i=indexInicio;i<naturezas.length;i++)naturezas[i].checked||contador++;if(contador===naturezas.length-indexInicio)return!0};document.getElementById("classificacao").addEventListener("change",function(e){if(naturezas[0].checked&&desmarcados(1)?(variaveisGlobais.controlarVisibilidade("ocultar","#ordenacao"),variaveisGlobais.controlarVisibilidade("ocultar","#intervaloDesde"),variaveisGlobais.controlarVisibilidade("ocultar","#intervaloAte")):(variaveisGlobais.controlarVisibilidade("exibir","#ordenacao"),variaveisGlobais.controlarVisibilidade("exibir","#intervaloDesde"),variaveisGlobais.controlarVisibilidade("exibir","#intervaloAte")),desmarcados(0))for(let i=0;i<naturezas.length;i++)naturezas[i].checked=!0}),document.getElementById("dataDesde").addEventListener("change",function(e){var chaveOpcoes=[];switch(document.getElementById("dataDesde").value){case"12":chaveOpcoes=[!0,!1,!1,!1],0==document.getElementById("dataAte").selectedIndex&&(document.getElementById("dataAte").selectedIndex=1);break;case"6":chaveOpcoes=[!0,!0,!1,!1],document.getElementById("dataAte").selectedIndex<=1&&(document.getElementById("dataAte").selectedIndex=2);break;case"3":chaveOpcoes=[!0,!0,!0,!1],document.getElementById("dataAte").selectedIndex<=2&&(document.getElementById("dataAte").selectedIndex=3);break;case"1":chaveOpcoes=[!0,!0,!0,!0],document.getElementById("dataAte").selectedIndex<=3&&(document.getElementById("dataAte").selectedIndex=4);break;default:chaveOpcoes=[!1,!1,!1,!1]}for(let i in chaveOpcoes)document.getElementById("dataAte")[i].disabled=chaveOpcoes[i]}),window.addEventListener("DOMContentLoaded",function(){recuperarBusca();const resultadosVideos=document.querySelectorAll(".resultado-video"),resultadosFotos=document.querySelectorAll(".resultado-foto");if(resultadosFotos)for(let i=0;i<resultadosFotos.length;i++)resultadosFotos[i].classList.add("fa-instagram");if(resultadosVideos)for(let i=0;i<resultadosVideos.length;i++)resultadosVideos[i].classList.add("fa-youtube-play"),resultadosVideos[i].parentElement.parentElement.classList.remove("borda-video"),resultadosVideos[i].parentElement.parentElement.classList.add("borda-foto")});