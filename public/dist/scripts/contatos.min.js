var contatosConsulta=async function(termos,reservarAuditorios,analisarReservaAuditorios,gerenteSistema,chefeManutencao){return await $.ajax({type:"GET",url:"/recuperarContatos",data:{termos,reservarAuditorios,analisarReservaAuditorios,gerenteSistema,chefeManutencao},dataType:"json"}).done(function(msg){msg&&(variaveisGlobais.contatos=msg)}).fail(function(msg){console.log("Fail! "+msg.data)}),variaveisGlobais.removePreLoaders(".contatos"),variaveisGlobais.contatos},contatosEditar=async function(){var idContato=document.getElementsByTagName("form")[2].id;return await $.ajax({type:"GET",url:"/recuperarContatoPorId",data:{id:idContato},dataType:"json"}).done(function(msg){msg&&(variaveisGlobais.contatos=msg)}).fail(function(msg){console.log("Fail! "+msg.data)}),variaveisGlobais.removePreLoaders(".contatos"),variaveisGlobais.contatos},exibirContatos=function(contatos){document.getElementById("resultados").innerHTML="",document.getElementById("resultados").insertAdjacentHTML("beforeend",`<span>Foram encontrados ${contatos.length} contatos</span>`);for(let i=0;i<contatos.length;i++){var contato=`\n            <div class="contato" id="${contatos[i]._id}">\n                <h3>${contatos[i].nome}</h3>\n                <div class="edicao">\n                    <a href="/contatos/editar/${contatos[i]._id}"><button>editar</button></a><form action="/contatos/excluir/${contatos[i]._id}" method="post" id="excluir-contato" class="formulario" accept-charset="utf-8">\n                    <input type="text" class="hidden" name="id" value="${contatos[i]._id}">\n                    <input type="submit" value="excluir contato"></form>\n                </div>\n                <div class="dados">\n                    <div><strong>E-mail:</strong><p>${contatos[i].email}</p></div>\n                    <div><strong>Telefone:</strong><p>${contatos[i].telefone}</p></div>\n                    <div><strong>Vínculo:</strong><p>${contatos[i].vinculo}</p></div>\n                    <div><strong>Cargo:</strong><p>${contatos[i].cargo}</p></div>\n                    <div><strong>Grupos:</strong><p>${contatos[i].grupos}</p></div>\n                `;contatos[i].permissoes&&(contato+="<div><strong>Permissões:</strong> <ul>",contatos[i].permissoes.reservarAuditorios&&(contato+="<li>Solicitar reserva</li>"),contatos[i].permissoes.analisarReservaAuditorios&&(contato+="<li>Analisar pedidos de reserva</li>"),contatos[i].permissoes.gerenteSistema&&(contato+="<li>Gerência do Sistema</li>"),contatos[i].permissoes.chefeManutencao&&(contato+="<li>Chamados de Manutenção</li>"),contatos[i].permissoes.reservarAuditorios||contatos[i].permissoes.analisarReservaAuditorios||contatos[i].permissoes.gerenteSistema||contatos[i].permissoes.chefeManutencao||(contato+="<li>nenhum</li>"),contato+="</ul></div>"),contato+="</div></div>",document.getElementById("resultados").insertAdjacentHTML("beforeend",contato)}},inserirCargos=function(){let cargos,total=document.querySelectorAll(".input-cargo-div").length;cargos=`\n    <div class="input-cargos-div">\n        <div class="input-cargos">\n            <label for="contexto">contexto</label>\n            <input type="text" name="contexto" id="contexto${total}">\n        </div>\n        <div class="input-cargos">\n            <label for="cargo${total}">cargo</label>\n            <input type="text" name="cargo" id="cargo${total}">\n        </div>        \n        <i class="fa fa-times-circle"></i>\n    </div>`,document.querySelector(".cargos").insertAdjacentHTML("afterbegin",cargos)},recuperarCargos=function(cargos){document.querySelector(".cargos").innerHTML="";let DOMCargos="";for(let i=0;i<cargos.length;i++)DOMCargos+=`\n        <div class="input-cargos-div">\n            <div class="input-cargos">\n                <label for="contexto${i}">contexto</label>\n                <input type="text" name="contexto" id="contexto${i}" value="${cargos[i].contexto}">\n            </div>\n            <div class="inputcargosl">\n                <label for="cargo${i}">cargo</label>\n                <input type="text" name="cargo" id="cargo${i}" value="${cargos[i].cargo}">\n            </div>        \n            <i class="fa fa-times-circle"></i>\n        </div>`;document.querySelector(".cargos").insertAdjacentHTML("beforeend",DOMCargos)};document.addEventListener("DOMContentLoaded",async()=>{if(document.getElementById("localizar-contato")&&document.getElementById("btn-submit").addEventListener("click",async function(e){e.preventDefault();var termoBusca,reservar,analisar,gerente,manutencao,termos,reservarAuditorios,analisarReservaAuditorios,gerenteSistema,chefeManutencao;termos=document.getElementById("query").value,reservarAuditorios=document.getElementById("reservarAuditorios"),analisarReservaAuditorios=document.getElementById("analisarReservaAuditorios"),gerenteSistema=document.getElementById("gerenteSistema"),chefeManutencao=document.getElementById("chefeManutencao"),termos&&(termoBusca={$text:{$search:termos}}),reservarAuditorios.checked&&(reservar={"permissoes.reservarAuditorios":!0}),analisarReservaAuditorios.checked&&(analisar={"permissoes.analisarReservaAuditorios":!0}),gerenteSistema.checked&&(gerente={"permissoes.gerenteSistema":!0}),chefeManutencao.checked&&(manutencao={"permissoes.chefeManutencao":!0}),await contatosConsulta(termoBusca,reservar,analisar,gerente,manutencao),exibirContatos(variaveisGlobais.contatos)}),document.querySelector(".editar-contato")){var contato=await contatosEditar();document.getElementById("nome").value=contato.nome,document.getElementById("email").value=contato.email,contato.foto?document.getElementById("foto-sim").checked=!0:document.getElementById("foto-nao").checked=!0,document.getElementById("tel").value=contato.telefone,document.getElementById("vinculo").value=contato.vinculo,recuperarCargos(contato.cargos);var grupos="";for(let i=0;i<contato.grupos.length;i++)i<contato.grupos.length-1?grupos+=`${contato.grupos[i]},`:grupos+=contato.grupos[i];document.getElementById("grupos").value=grupos,contato.permissoes&&(contato.permissoes.reservarAuditorios&&(document.getElementById("reservarAuditorios").checked=!0),contato.permissoes.analisarReservaAuditorios&&(document.getElementById("analisarReservaAuditorios").checked=!0),contato.permissoes.gerenteSistema&&(document.getElementById("gerenteSistema").checked=!0),contato.permissoes.chefeManutencao&&(document.getElementById("chefeManutencao").checked=!0))}(document.querySelector(".editar-contato")||document.querySelector(".inserir-contato"))&&(document.querySelector(".inserir-cargo").addEventListener("click",inserirCargos),document.querySelector(".cargos").addEventListener("click",function(e){e.target.classList.contains("fa-times-circle")&&e.target.parentElement.remove()}))});