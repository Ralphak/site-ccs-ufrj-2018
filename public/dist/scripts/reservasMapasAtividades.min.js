var header='\n    <div id="mapa-header">\n        <div class="marca"></div>\n    </div>\n',recuperarAuditorios=async function(){var todosAuditorios;return await $.ajax({type:"GET",url:"/recuperarAuditorios",dataType:"json"}).done(function(msg){msg&&(todosAuditorios=msg)}).fail(function(msg){console.log("Fail! "+msg.data)}),todosAuditorios},recuperarReservas=async function(){var todasReservas;return await $.ajax({type:"GET",url:"/recuperarReservas",dataType:"json"}).done(function(msg){msg&&(todasReservas=msg)}).fail(function(msg){console.log("Fail! "+msg.data)}),todasReservas},auditoriosDOM=function(aud){var content="";for(let i=0;i<aud.length;i++)content+=`\n            <div id="${aud[i]._id}" class="auditorio">\n            <img src="/img/auditorios/${aud[i]._id}.jpg">\n            <h3 class="nome">${aud[i].nome}</h3>\n            <p>Capacidade: ${aud[i].capacidade} pessoas</p>\n            </div>`;document.querySelector(".auditorios-wrapper").insertAdjacentHTML("beforeend",content)},filtrarReservas=function(auditorio,reservas){var reservasFiltradas=[];for(let i=0;i<reservas.length;i++)reservas[i].auditorio===auditorio&&"agendado"===reservas[i].status&&reservasFiltradas.push(reservas[i]);return reservasFiltradas},mapa=function(periodo,reservas,auditorio,auditorioId){var dias,semana=moment().week(),inicioSemana=moment().week(semana).day(1),inicioProximaSemana=moment(inicioSemana).add(7,"days");"estaSemana"===periodo?(primeiroDia=inicioSemana,dias=5):"proximaSemana"===periodo?(primeiroDia=inicioProximaSemana,dias=5):(primeiroDia=periodo,dias=1),document.getElementById("reservas-semana")?document.getElementById("reservas-semana").innerHTML+=`<h2>${auditorio}</h2>`:document.getElementById("reservas-dia")&&(document.getElementById("reservas-dia").innerHTML+=`<h2>${auditorio}</h2>`);for(var i=0;i<dias;i++){var reservasDoDia=[];variaveisGlobais.dataSelecionada=moment(primeiroDia).add(i,"days");for(let j=0;j<reservas.length;j++)for(let k=0;k<reservas[j].horarios.length;k++)reservas[j].horarios[k].split("-")[2]===moment(variaveisGlobais.dataSelecionada).format("DD")&&reservasDoDia.push(reservas[j].horarios[k]);var dia=`\n        <div id="dia-${auditorioId}-${moment(variaveisGlobais.dataSelecionada).format("YYYY-MM-DD")}" class="dia-main-div">\n            <div class="dia-header dia-${auditorioId}-${moment(variaveisGlobais.dataSelecionada).format("YYYY-MM-DD")}">\n                <h2></h2>\n                <span></span>\n            </div>\n            <div id="horarios-${auditorioId}-${moment(variaveisGlobais.dataSelecionada).format("YYYY-MM-DD")}" class="horarios"></div>\n        </div>`;document.getElementById("reservas-semana")?document.getElementById("reservas-semana").insertAdjacentHTML("beforeend",dia):document.getElementById("reservas-dia")&&document.getElementById("reservas-dia").insertAdjacentHTML("beforeend",dia),horariosDOM(`horarios-${auditorioId}-${moment(variaveisGlobais.dataSelecionada).format("YYYY-MM-DD")}`),variaveisGlobais.exibirDia(reservas,auditorioId)}},horariosOcupados=function(){var horariosContainer=document.querySelectorAll(".horarios");for(i=0;i<horariosContainer.length;i++){var horarios=document.querySelectorAll(`#${horariosContainer[i].id} .horario`),temReserva=!1;for(j=0;j<horarios.length;j++)(horarios[j].classList.contains("agendado")||horarios[j].classList.contains("requisitado"))&&(temReserva=!0);temReserva||horariosContainer[i].classList.contains("feriado")?!temReserva&&horariosContainer[i].classList.contains("feriado")&&(horariosContainer[i].innerHTML="Feriado",horariosContainer[i].classList.add("livre")):(horariosContainer[i].innerHTML="Não há reservas nesta data",horariosContainer[i].classList.add("livre"))}};document.addEventListener("DOMContentLoaded",async function(){document.querySelector(".agenda-desktop").outerHTML="";var auditorio,reservasFiltradas,auditorios=await recuperarAuditorios(),reservas=await recuperarReservas();if(document.getElementById("escolher-semana")){auditoriosDOM(auditorios);document.querySelector(".auditorios-wrapper").addEventListener("click",async function(e){e.target.classList.contains("auditorio")&&(audId=e.target.id,auditorio=document.querySelector(`#${e.target.id} .nome`).innerHTML,reservasFiltradas=filtrarReservas(e.target.id,reservas),document.getElementById("overlay").classList.add("branco-translucido"),document.getElementsByTagName("body")[0].classList.add("fixed"),variaveisGlobais.controlarVisibilidade("exibir","#overlay"),variaveisGlobais.controlarVisibilidade("exibir","#escolher-semana"))}),document.getElementById("escolher-semana").addEventListener("click",function(e){if(e.target.classList.contains("opcao-semana")&&e.target.classList.contains("esta-semana")?periodo="estaSemana":e.target.classList.contains("opcao-semana")&&(periodo="proximaSemana"),!e.target.classList.contains("fa-times")){if(document.getElementById("reservas-semana").innerHTML="",document.getElementById("reservas-semana").innerHTML=header,document.getElementById("mapa-header").insertAdjacentHTML("beforeend","<p>Atividades na semana</p>"),mapa(periodo,reservasFiltradas,auditorio,audId),horariosOcupados(),"quinhentao"===audId){document.getElementById("reservas-semana").insertAdjacentHTML("beforeend",'\n                        <p class="info">Obs: O Hall do Quinhentão, quando não solicitado, será utilizado nos dias e horários abaixo:</p>\n                        <p class="info">Aula de Samba: 2ª e 4ª feiras de 17 às 18h | Aula de Bolero: 3ª e 5ª de 12 às 13h | Aula de Forró: 3ª e 5ª  de 17 às 18h</p>\n                    ')}setTimeout(function(){window.print()},30)}variaveisGlobais.controlarVisibilidade("ocultar","#overlay"),document.getElementsByTagName("body")[0].classList.remove("fixed"),variaveisGlobais.controlarVisibilidade("ocultar","#escolher-semana")})}else if(document.getElementById("reservas-dia")){var aud=[],audId=[];for(let i=0;i<auditorios.length;i++)aud.push(auditorios[i].nome),audId.push(auditorios[i]._id);$("#datepickerMapaDia").datepicker({minDate:variaveisGlobais.antecedenciaMinima,maxDate:variaveisGlobais.antecedenciaMaxima,beforeShowDay:$.datepicker.noWeekends,dateFormat:"yy-mm-dd"}).on("input change",function(e){document.getElementById("reservas-dia").innerHTML="";for(let i=0;i<aud.length;i++)reservasFiltradas=filtrarReservas(audId[i],reservas),mapa(e.target.value,reservasFiltradas,aud[i],audId[i]),horariosOcupados();document.getElementById("reservas-dia").insertAdjacentHTML("afterbegin",`${header}<h2>Atividades do dia ${moment(variaveisGlobais.dataSelecionada).format("DD [de] MMMM [de] YYYY")}</h2>`),document.getElementById("mapa-header").insertAdjacentHTML("beforeend","<p>Atividades nos espaços da Decania do CCS</p>"),setTimeout(function(){window.print()},10)})}});