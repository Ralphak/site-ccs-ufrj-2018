var horarios=[],antMax=variaveisGlobais.antecedenciaMaxima,antMaxNum=variaveisGlobais.antecedenciaMaximaNumber,antMin=variaveisGlobais.antecedenciaMinima,carrinho=document.getElementById("carrinho-horarios"),botaoCarrinho=document.getElementById("botao-carrinho"),inputsObrigatorios=document.querySelectorAll("input[required], select[required], textarea[required]"),publico=document.getElementById("publico"),eventos=["colação de grau","evento comemorativo de Unidade","evento comemorativo","cerimônia de posse","aula inaugural","recepção de calouros","semana acadêmica","workshop","simpósio","palestra/conferência","reunião do Conselho de Centro","congregação de Unidades","defesa de dissertação/tese","defesa de TCC","seminário","reuniões diversas","formatura","debates sobre consulta eleitoral - Unidades","forum","semana de treinamentos","mesa redonda","VI Semana da Fórmula","eventos variados","reunião"],auditorios={quinhentao:[eventos[0],eventos[1],eventos[3],eventos[4],eventos[5],eventos[6],eventos[7],eventos[8],eventos[9]],helioFraga:[eventos[10],eventos[11],eventos[12],eventos[9],eventos[8],eventos[2],eventos[14],eventos[23],eventos[4],eventos[5],eventos[16],"reunião de Extensão","Liga Acadêmica","diálogo de conclusão","apresentação de vídeo"],audN:[eventos[6],eventos[7],eventos[14],eventos[2],eventos[22],eventos[8],eventos[9],eventos[0],eventos[12],eventos[10],eventos[4],eventos[3],eventos[23],eventos[17],"jornada","fórum","semana de treinamentos","mesa redonda","Semana da Fórmula"],bezao:[eventos[5],"provas - graduação e pós-graduação","prova - processos seletivos","assembleia","encontro estudantil"],n106:[eventos[9],eventos[23],"vídeo-conferência"],n202:[eventos[12],eventos[22],eventos[23],eventos[13],eventos[7],eventos[4],eventos[14],"ciclos de debates e debates variados","prova","Cine Debate","Biossemana","Jornada de Pós-Graduação"],bib:[eventos[0]]};document.addEventListener("scroll",function(){document.querySelector(".footer").getBoundingClientRect().top>window.innerHeight?(botaoCarrinho.style.bottom="10px",botaoCarrinho.style.top="unset"):(botaoCarrinho.style.top=document.querySelector(".footer").getBoundingClientRect().top-130+"px",botaoCarrinho.style.bottom="unset")});var validarFormulario=e=>{if(e.preventDefault(),!variaveisGlobais.disabled&&Number(publico.value)<=Number(publico.max)){let camposInvalidos;!(camposInvalidos=variaveisGlobais.checarInputs(inputsObrigatorios))&&!variaveisGlobais.disabled&&document.getElementById("emailResponsavel").value.search("@")>=0?0===horarios.length?variaveisGlobais.exibirMensagem("Adicione ao menos um horário ao seu pedido de reserva.",2500):(variaveisGlobais.clickingOnce(),document.getElementById("formReserva").submit()):!camposInvalidos&&document.getElementById("emailResponsavel").value.search("@")<0&&$("html, body").animate({scrollTop:$("#emailResponsavel").offset().top-120},"slow",function(){variaveisGlobais.exibirMensagem("É necessário informar um endereço de e-mail válido.",2e3)})}else Number(publico.value)>Number(publico.max)&&$("html, body").animate({scrollTop:$("#publico").offset().top-120},"slow",function(){variaveisGlobais.exibirMensagem(`O público esperado deve ser menor que a capacidade da sala, ${publico.max} pessoas.`,2e3)})};document.querySelector(".reservas-dia-container").addEventListener("click",function(e){if((e.target.classList.contains("fa-caret-left")||e.target.classList.contains("fa-caret-right"))&&(variaveisGlobais.refreshDiv(horarios),variaveisGlobais.exibirDia(variaveisGlobais.reservas)),e.target.classList.contains("horario")&&!e.target.classList.contains("requisitado"))if(e.target.classList.contains("incluir")){e.target.classList.remove("incluir");for(let i=horarios.length;i>=0;i--)moment(variaveisGlobais.dataSelecionada).format("YYYY-MM-DD[-]")+e.target.id===horarios[i]&&horarios.splice(i,1);document.getElementById("horarios").value=horarios}else document.getElementById(e.target.id).classList.add("incluir"),horarios.push(moment(variaveisGlobais.dataSelecionada).format("YYYY-MM-DD[-]")+e.target.id),document.getElementById("horarios").value=horarios;if(horarios.length>0){var carrinho=horariosDOMCarrinho(horarios);document.getElementById("carrinho-horarios").innerHTML="",document.getElementById("carrinho-horarios").insertAdjacentHTML("beforeend",carrinho)}else document.getElementById("carrinho-horarios").innerHTML="<h3>Resumo do pedido</h3><i class='fa fa-times fechar-carrinho'></i><div class='carrinho-vazio'><p class='text-shadow-inset'>Adicione ao menos um horário para enviar seu pedido de reserva</p></div>"}),document.getElementById("btn-submit").addEventListener("click",function(e){validarFormulario(e)}),document.getElementById("publico").addEventListener("input",function(e){var publicoContainer=document.getElementById("publico-container"),capacidadeAud=document.querySelector("span.capacidade-auditorio");Number(e.target.value)>e.target.max?(document.getElementById("publico").focus(),capacidadeAud.classList.remove("hidden"),publicoContainer.classList.add("capacidade-auditorio")):publicoContainer.classList.contains("capacidade-auditorio")&&(capacidadeAud.classList.add("hidden"),publicoContainer.classList.remove("capacidade-auditorio"))}),document.getElementById("carrinho-horarios").addEventListener("click",function(e){if(e.target.classList.contains("eliminar-horario")){moment(e.target.previousElementSibling.id.substr(9,10)).format("YYYY MM DD")===moment(variaveisGlobais.dataSelecionada).format("YYYY MM DD")&&document.getElementById(e.target.previousElementSibling.id.substring(20)).classList.remove("incluir"),document.getElementById("horarios").value="";for(let i=0;i<horarios.length;i++)e.target.previousElementSibling.id.substring(9)===horarios[i]&&horarios.splice(i,1);document.getElementById("horarios").value=horarios,e.target.parentElement.classList.add("maior"),setTimeout(function(){e.target.parentElement.classList.add("minimiza"),e.target.parentElement.classList.add("opacidade-zero")},300),setTimeout(function(){if(document.getElementById("carrinho-horarios").innerHTML="",horarios.length>0){var carrinho=horariosDOMCarrinho(horarios);document.getElementById("carrinho-horarios").insertAdjacentHTML("beforeend",carrinho)}else document.getElementById("carrinho-horarios").innerHTML="<h3>Resumo do pedido</h3><i class='fa fa-times fechar-carrinho'></i><div class='carrinho-vazio'><p class='text-shadow-inset'>Adicione ao menos um horário para enviar seu pedido de reserva</p></div>"},800)}e.target.classList.contains("fechar-carrinho")&&carrinho.classList.remove("aberto")},!0),botaoCarrinho.addEventListener("click",function(){carrinho.classList.toggle("aberto")});var horariosDOM=function(){var estruturaAgenda=`<div id="dia-${moment(variaveisGlobais.dataSelecionada).format("YYYY-MM-DD")}" class="dia-header dia-${moment(variaveisGlobais.dataSelecionada).format("YYYY-MM-DD")}"><i class="fa fa-caret-left"></i><h2></h2><i class="fa fa-caret-right"></i><span></span></div><div id="horarios-${moment(variaveisGlobais.dataSelecionada).format("YYYY-MM-DD")}" class="horarios"><h2>Feriado</h2></div>`,html="";document.querySelector(".reservas-dia-container").insertAdjacentHTML("beforeend",estruturaAgenda);for(let i=0;i<variaveisGlobais.intervalos.length;i++){if("n202"===document.querySelector("main").id&&i>2)discGrad="disc-grad";else var discGrad="";html+='<div class="horario livre '+discGrad+'" id="'+("0"+variaveisGlobais.intervalos[i]).slice(-2)+'"><span>'+("0"+variaveisGlobais.intervalos[i]).slice(-2)+"h - "+variaveisGlobais.horaFim(variaveisGlobais.intervalos[i])+'h</span><p class="nomeEvento"></p></div>'}document.querySelector(".horarios").insertAdjacentHTML("beforeend",html)},agendaReservas=async function(){return auditorio=document.querySelector(".reserva").id,await $.ajax({type:"GET",url:"/recuperarReservasAuditorio",data:{auditorio},dataType:"json"}).done(function(msg){msg&&(variaveisGlobais.reservas=msg)}).fail(function(msg){console.log("Fail! "+msg.data)}),variaveisGlobais.reservas},horariosDOMCarrinho=function(horarios){var reserva;horarios.sort();var hora=horarios[0].substring(11,13);reserva='<div class = reserva> <h3>Resumo do pedido</h3><i class="fa fa-times fechar-carrinho"></i><p class="dia"><strong>'+moment(horarios[0].substring(0,10)).format("DD")+" de "+moment(horarios[0].substring(0,10)).format("MMMM")+"</strong></p>",reserva+='<div><span class="horario-carrinho" id="carrinho-'+horarios[0].substring(0,13)+'">'+hora+":00 - "+variaveisGlobais.horaFim(Number(hora))+':00</span><i class="fa fa-times eliminar-horario"></i></div>';for(let i=1;i<horarios.length;i++){var horaI=horarios[i].substring(11,13);horarios[i].substring(0,10)===horarios[i-1].substring(0,10)?reserva+='<div><span class="horario-carrinho" id="carrinho-'+horarios[i].substring(0,13)+'">'+horaI+":00 - "+variaveisGlobais.horaFim(Number(horaI))+':00</span><i class="fa fa-times eliminar-horario"></i></div>':(reserva+="</div>",reserva+='<div class = reserva><p class="dia"><strong>'+moment(horarios[i].substring(0,10)).format("DD")+" de "+moment(horarios[i].substring(0,10)).format("MMMM")+"</strong></p>",reserva+='<div><span class="horario-carrinho" id="carrinho-'+horarios[i].substring(0,13)+'">'+horaI+":00 - "+variaveisGlobais.horaFim(Number(horaI))+':00</span><i class="fa fa-times eliminar-horario"></i></div>')}return reserva+="</div>",reserva+='<div class="carrinho-submit"><span class="dica">Certifique-se de ter preenchido todos campos do formulário e clique no botão abaixo para submeter seu pedido</span><button type="submit" form="formReserva" id="btn-carrinho-submit">Enviar</button></div>'},controlarSetas=function(){moment(variaveisGlobais.dataSelecionada).format("DD-MM-YYYY")===moment(new Date).add(antMin,"days").format("DD-MM-YYYY")?document.querySelector(".fa-caret-left").classList.add("inactive"):document.querySelector(".fa-caret-left").classList.remove("inactive"),moment(variaveisGlobais.dataSelecionada).format("DD-MM-YYYY")===moment(new Date).add(antMaxNum,"months").format("DD-MM-YYYY")?document.querySelector(".fa-caret-right").classList.add("inactive"):6===moment(new Date).add(antMaxNum,"months").day()&&moment(variaveisGlobais.dataSelecionada).format("DD-MM-YYYY")===moment(new Date).add(antMaxNum,"months").subtract(1,"days").format("DD-MM-YYYY")?document.querySelector(".fa-caret-right").classList.add("inactive"):0===moment(new Date).add(antMaxNum,"months").day()&&moment(variaveisGlobais.dataSelecionada).format("DD-MM-YYYY")===moment(new Date).add(antMaxNum,"months").subtract(2,"days").format("DD-MM-YYYY")?document.querySelector(".fa-caret-right").classList.add("inactive"):document.querySelector(".fa-caret-right").classList.remove("inactive")},naturezaEvento=function(){var aud=document.querySelector("main").id,naturezas=auditorios[aud].sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())});for(let i=0;i<auditorios[aud].length;i++)document.getElementById("naturezaEvento").insertAdjacentHTML("beforeend",`<option value="${naturezas[i]}">${naturezas[i]}</option>`)};window.addEventListener("DOMContentLoaded",async function(e){naturezaEvento(),horariosDOM();var reservas=await agendaReservas(),diasComEvento=variaveisGlobais.checarAtividades(reservas);variaveisGlobais.datepicker(diasComEvento,!0,horarios),variaveisGlobais.exibirDia(reservas),variaveisGlobais.controleDatepicker(),document.getElementById("carrinho-horarios").addEventListener("click",function(e){validarFormulario(e)})});